<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title></title>
		<link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">  
		<script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
		<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/js-conflux-sdk/dist/js-conflux-sdk.umd.min.js"></script>
		<script src="js/hecorpc.js"></script>
		<script src="js/confluxrpc.js"></script>
		<script src="js/contract_cfx1.js"></script>
		<script src="js/bootbox.min.js"></script>
		<link rel="stylesheet" type="text/css" href="css/index.css"/>
		<script src="js/index.js" type="text/javascript" charset="utf-8"></script>
		<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1"/>

	</head>
	<body>
	<!-- 头部 -->
	<div class="container-fluid" >
			<div class="row" style="background:#363433;height:40px;">
				<div class="col-xs-6" style="padding-left:40px;margin-top:10px;">
						<ul class="list-inline">
							<li><img src="images/TopTB.png" style="width:30px;height:30px;margin-top:-5px;"></li>
							<li><strong class="fontcolor8">DSME</strong></li>
						</ul>
				</div>
				<!-- 头部右侧HECO+菜单栏 -->
				<div class="col-xs-4 col-xs-offset-1">
					    <div class="row">
					    	<div class="col-xs-4" style="margin-top:8px;">
					    		<button type="button" id="node_www" class="fontcolor9" style="width:75px;height:25px;border-radius:90.3px;border:none;">NOT</button>
					    	</div>
					    	<div class="col-xs-7" style="margin-top:8px;padding-left:60px;">
					    		<div class="dropdown">
									<!-- 菜单栏 -->
					    		    <span class="glyphicon glyphicon-align-justify dropdown-toggle fontcolor8" style="font-size:18px" id="dropdownMenu1" data-toggle="dropdown"></span>
					    		    <!-- 菜单栏下拉内容 -->
									<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1" style="min-width:95px;border-radius:12px; font-size:16px;margin-left:-47px;margin-top:9px;background:#000000CC;text-align:center">
					    		        <li role="presentation">
					    		            <a role="menuitem" style="color:#f5f5f7;" tabindex="-1" href="index.html">首页</a>
					    		        </li>
					    		        <li role="presentation">
					    		            <a role="menuitem" style="color:#f5f5f7;" tabindex="-1" href="#">Dao</a>
					    		        </li>
					    		        <li role="presentation">
					    		            <a role="menuitem" style="color:#f5f5f7;" tabindex="-1" href="#">Defi</a>
					    		        </li>
					    		    </ul>
					    		</div>
					        </div>
					    </div>
				</div>
			</div>
	</div>
	<!-- 轮播图 -->
	<!-- 轮播图模块 -->
	<div class="container-fluid" style="margin-top:3px">
		<div class="container">
			<div id="myCarousel" class="row carousel slide" data-ride="carousel">
			    <!-- 轮播（Carousel）指标 -->
			    <ol class="carousel-indicators">
			        <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
			        <li data-target="#myCarousel" data-slide-to="1"></li>
			        <li data-target="#myCarousel" data-slide-to="2"></li>
			    </ol>   
			    <!-- 轮播（Carousel）项目 -->
			    <div class="carousel-inner">
			        <div class="item active">
			            <img src="./images/loge1.png" alt="First slide">
			            <div class="carousel-caption"></div>
			        </div>
			        <div class="item">
			            <img src="./images/loge2.png" alt="Second slide">
			            <div class="carousel-caption"></div>
			        </div>
			        <div class="item">
			            <img src="./images/loge3.png" alt="Third slide">
			            <div class="carousel-caption"></div>
			        </div>
			    </div>
			    <!-- 轮播（Carousel）导航 -->
			    <a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
			        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
			        <span class="sr-only">Previous</span>
			    </a>
			    <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
			        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
			        <span class="sr-only">Next</span>
			    </a>
			</div>
		</div>
	</div>
	<!-- DAO生态数据展示 -->
	<div class="container-fluid" style="margin-top:8px;">
		<div class="container fontcolor7" style="color:#f4f4f6;border-radius:12px;">
			<div class="row" style="text-align:center;margin-top: 18px;">
						<h4 style="color:#f4f4f6c2">持币地址(HECO&CONFLUX)</h4>
					</div>
					<div class="row" style="text-align:center;color:#a80077">
						<span>225</span>&nbsp;个
					</div>
					<div class="row" style="text-align:center;">
						<h4 style="color:#f4f4f6c2">DSME流通量(HECO&CONFLUX)</h4>
					</div>
					<div class="row" style="text-align:center;color:#B3FFAB">
						<span>42,884.16</span>&nbsp;DSME
					</div>
					<!-- 留白行 -->
					<div class="row" style="height:15px;">
						<!-- 留白行 -->
					</div>
			</div>
		</div>
	</div>
	<!-- 签到功能 -->
	<div class="container-fluid" style="margin-top:8px;">
		<div class="container fontcolor6"style="text-align:center;border-radius:12px;">
			<!-- 盲盒空投 -->
			<div class="row">
				<h3 style="color:#86a0a9">盲盒空投</h3>
			</div>
			<!-- 盲盒空头规则 -->
			<div class="row" style="margin-left: 250px;margin-top: -15px;">
				<button type="button"data-toggle="modal" class="fontcolor6 btn" data-target="#myModal1" style="border-radius:20px;background-color:#ead1ea40;outline:none;"><strong>空投规则</strong></button>
			</div>
			<!-- 规则模态框 -->
			<div class="modal fade " id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				<div class="modal-dialog" >
					<div class="modal-content"style="background-color:#cecece;">
						<!-- 提示框头部+关闭符号 -->
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" 
									aria-hidden="true">×
							</button>
							<!-- 标题内容 -->
							<h4 class="modal-title" id="myModalLabel" style="text-align: center;">
								<strong>DSME盲盒空投规则</strong>
							</h4>
						</div>
						<!-- 模态框主要内容 -->
						<div class="modal-body">
							<!-- 规则内容 -->
							<div class="row"style="width:92%;margin-left:14px;border-radius:10px;">					
								1、流程：通过特邀链接激活-加入微信群-发送钱包地址等待添加白名。
								2、初级空投、中级空投每24小时可以领取一次。
								3、中级空投C链暂未开放。
								4、每次0.4-1.2cDSME。
								5、邀请奖励:一级50%，二级20%，邀请链接联系微信获取。
								cDSME合约地址:<br>cfx:acayf79s2bdjn8hhrjkj4g2j75e44y9rja1prjy0a9。
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- 分割线行 -->
			<!-- <div class="row"style="border-bottom:1px solid rgb(99, 111, 164);padding-bottom:10px"> -->
				<!-- 分割线 -->
			<!-- </div> -->
			<div class="row" style="margin-top:10px;">
					<div class="col-xs-4" style="background-color:#6051902e;width:130px;text-align:center;border-radius:12px;left:30px;">
						<div class="row">
							<h4>初级空投</h4>
						</div>
						<div class="row">
							领取次数:&nbsp;<span id = "chu_ge" style="color:#7F00FF;">0</span>&nbsp;次
						</div>
						<div class="row">
							参与人次:&nbsp;<span id = "chu_all" style="color:#7303c0;">0</span>&nbsp;次
						</div>
						<div class="row" style="margin-top:10px">
							<button id = "button_chuji" type="button" class="btn" style="border-radius:12px;width:70px;background-color:#ead1ea40">领取</button>
						</div>
						<!--留白行-->
						<div class="row" style="height:10px">
						    <!--留白行-->
						</div>
					</div>
					<!-- 中级空投详情 -->
					<div class="col-xs-4" style="background-color:#6051902e;width:130px;text-align:center;border-radius:12px;left:72px;">
						<div class="row">
							<h4>中级空投</h4>
						</div>
						<div class="row" >
							领取次数:&nbsp;<span id = "zhong_ge" style="color:#7F00FF;">0</span>&nbsp;次
						</div>
						<div class="row">
							参与人次:&nbsp;<span id = "zhong_all" style="color:#7303c0;">0</span>&nbsp;次
						</div>
						
						<div class="row"style="margin-top:10px">
							<button id = "button_zhongji" type="button" class="btn" style="border-radius:12px;width:70px;background-color:#ead1ea40">领取</button>
						</div>
						<!--留白行-->
						<div class="row" style="height:10px">
						    <!--留白行-->
						</div>
					</div>
			</div>
			<!-- 留白行 -->
			<div class="row" style="height: 30px;">
				<!-- 留白行 -->
			</div>
		</div>
	</div>
	<!-- 单币质押功能 -->
	<div class="container-fluid">
		<div class="container fontcolor4"style="margin-top:8px;border-radius:20px;">
			<!-- DSME单币质押标题 -->
			<div class="row" style="text-align:center;">
				<h3 style="color:#86a0a9">DSPOOL CFX/FC LP</h3>
			</div>
			<!-- 单笔质押头部第一行 -->
			<div class="row" style="margin: 0 0;">
				<!-- 提案信息图标+文字 -->
				<div class="col-xs-4" style="padding:0px;margin-top:9px;">
					<ul class="list-inline">
						<li><img src="images/TopTB.png" style="width:30px;height:30px;margin-top:-5px;"></span></li>
						<li><h4 style="color:#c8522c">CFX/FC</h4></li>
					</ul>
				</div>
				<!-- 提案信息折叠符号 -->
				<div class="col-xs-3 col-xs-offset-5"style="padding-left:40px;margin-top:11px;">
					<button type="button" class="bt btn btn-link" data-toggle="collapse" data-target="#demo">
					    <span class="glyphicon glyphicon-chevron-down" style="color: red;"></span>
					</button>
				</div>
			</div>
			<!-- 单笔质头部内容 -->
			<!-- Earned -->
			<div class="row">
				<div class="col-xs-4"style="color:gray;">
					Enrned
				</div>
				<div class="col-xs-5 col-xs-offset-3" style="text-align:right;color:royalblue;">
					<strong><span id="lpShouyi">0.00000</span>&nbsp;cDSME</strong>
				</div>
			</div>
			<!-- APY -->
			<div class="row"style="color:gray;">
				<div class="col-xs-4">
					APY
				</div>
				<div class="col-xs-5 col-xs-offset-3"style="text-align:right;color: green;">
					<strong><span id="lpApy">0.00%</span></strong>
				</div>
			</div>
			<!-- Total Deposit -->
			<div class="row">
				<div class="col-xs-4"style="color:gray;">
					Total Deposit
				</div>
				<div class="col-xs-5 col-xs-offset-3"style="text-align:right;">
					<strong><span id="lpAll">0.00</span></strong>
				</div>
			</div>
			<!--留白行-->
			    <div class="row" style="height:15px">
			    </div>
			<!-- 被折叠的提案信息内容 -->
			<div id="demo" class="row collapse" style="margin:0 0;line-height:30px;">
				<div class="row">
					<div class="col-xs-4"style="color:gray;">
						<strong style="color:black">Balance</strong>:<br><span id="dsmeBanlance">0.00</span>&nbsp;cDSME
					</div>
					<div class="col-xs-4 col-xs-offset-4"style="text-align:right;color:gray;">
						<strong style="color:black">Balance</strong>:<br><span id="cfxfcBanlance">0.00</span>&nbsp;CFX/FC
					</div>
				</div>
				<div class="row">
					<div class="container-fluid">
						<!-- 授权数量input框 -->
						<form action="" method="post" style="margin-left:30px;">
							<input id="approveValue" type="text" class="bt btn btn-link"style="border-radius:25px;width:90%;height:50px;border:none;background-color:#f0f0f05c;" value="" placeholder=""/>
						</form>
						<!-- 滑动进度条 -->
						
						<!-- 授权按钮 -->
						<div class="row" style="margin-left:115px; margin-top:15px">
							<button id="approve" type="button" class="btn-lg fontcolor1">Approve</button>
						</div>
						<!-- Deposited沉积+Earned -->
						<div class="row">
							<!-- Deposited沉积 -->
							<div class="col-xs-4"style="color:gray;">
								<strong style="color:black;">Deposited:</strong><br><span id="dcflBanlance">0.00</span>&nbsp;CFX/FC
							</div>
							<!-- Earned -->
							<div class="col-xs-8" style="text-align:right;color:gray;">
								<strong style="color:black;">Earned:</strong><br><span>0.00</span>&nbsp;cDSME&nbsp;&nbsp;<span></span>&nbsp;
							</div>
						</div>
						<!-- 确认输入框数量 -->
						<!-- 授权数量input框 -->
						<form action="" method="post" style="margin-left: 30px;">
							<input id="changeValue" type="text" class="bt btn btn-link" style="border-radius:25px;width:90%;height:50px;border:none;background-color:#f0f0f05c;"  value="" placeholder=""/>
						</form>
						<!-- 滑动进度条 -->
						<!-- 撤回+质押确认按钮 -->
						<div class="row" style="margin-top:15px">
							<!-- Withdraw撤回按钮 -->
							<div class="col-xs-4 col-xs-offset-1">
								<button id="withdraw" type="buttons" class="btn-lg fontcolor2">Withdraw</button>
							</div>
							<!-- Claim质押按钮 -->
							<div class="col-xs-4 col-xs-offset-2">
								<button id="pledge" type="button" class="btn-lg fontcolor3">Pledge</button>
							</div>
						</div>
					</div>
				</div>
				<!--留白行-->
			    <div class="row" style="height:15px">
			    </div>
			</div>
		</div>
		<!-- //折叠内容js -->
		<script>
		    $(document).ready(function(){
				$('#demo').collapse('hide');
		        $("#demo").on("hide.bs.collapse", function(){
		            $(".bt").html('<span class="glyphicon glyphicon-chevron-down" style="color: red;"></span>');
		        });
		        $("#demo").on("show.bs.collapse", function(){
		            $(".bt").html('<span class="glyphicon glyphicon-chevron-up" style="color: red;"></span>');
		        });
		    });

			//公共数据RPC节点获取
			//初级空投heco领取人次
			KC_heco.methods.random().call().then(function(res){
				//初级空投conflux领取人次
				kongtouR.random().call({from:"0x1a781152365291daa5e06617e59019c7d7c8cc6b"}).then(function(response){
					$("#chu_all").html( response[0]/1 + res/1 );
				})
			})
			//中级空投领取人次
			KZ_heco.methods.random().call().then(function(response){
				$("#zhong_all").html( response/2 + 1845.5 );
			})
			//lp质押总量与质押年华率
			//lp显示
			dspoolcflR.pledge_all().call().then(function(res){
				dspoolcflR.reward_day().call().then(function(rr){
					$("#lpAll").html(toDecimal2(res/ 10**18));
					$("#lpApy").html(toDecimal2((rr*365)/(res)) + "%" );	
				})
			})
			
			//中级空投未开放
			button_zhongji.onclick = function(){
				bootbox.alert({
					title: "<h4><strong style='color:gray;margin-left:5px'>空投提示</strong></h4>",
					message: "暂未开放",
				})
			}

			//获取账户地址
			conflux.enable().then(function(accounts){
				//查询cDSME数量
				chaxuncoin.requrieBanlance("0x8142f7eec04685f8e76a128d1b08eec9ad53ed40").call({from:accounts[0]}).then(function(response){
					$("#dsmeBanlance").html(toDecimal2(response/10**18));
				})
				//查询CFX/FC LP 持币数量
				chaxuncoin.requrieBanlance("0x8df59e546877fc250f3d60934a3a4e1349810460").call({from:accounts[0]}).then(function(response){
					$("#cfxfcBanlance").html(toDecimal2(response/10**18));
				})
				//查询质押CFX/FC LP 数量
				chaxuncoin.requrieBanlance("0x831478f6e85d3481f123853065bc26660c699d81").call({from:accounts[0]}).then(function(response){
					$("#dcflBanlance").html(toDecimal2(response/10**18));
				})

				//显示网络
				$("#node_www").html( "CONFLUX" );
				
				//初级空投个人领取次数
				kongtouR.playmap(accounts[0]).call({from:accounts[0]}).then(function(resu) {
					if( resu[0].length == 0 ){
					$("#chu_ge").html(0);
					}else{
					$("#chu_ge").html(resu[1]);
					}
				})

				//邀请码
				var a = 1000;
				var aherf = window.location.href;

				//初级空投激活
				for(var i =  0 ;i<100;i++){
					if(aherf[i] == "i"){
						if(aherf[i+1] == "d"){
							a = aherf[i+3] + aherf[i+4] + aherf[i+5] + aherf[i+6];
							system.playerMap(accounts[0]).call().then(function(resu) {
								if(resu == 0){
									bootbox.confirm({
										size: "small",
										title: "资格激活",
										message: "您的好友赠送您初级空投资格，点击OK立刻激活",
										callback: function(re){
											if(re){
												system.registerforplayer("Dplayer",a).sendTransaction({from:accounts[0]}).then(function(result){
													if(result){
														bootbox.alert({
															size: "small",
															title: "激活提示",
															message: "激活成功，请立即加入群聊，开启空投领取",
														})
													}},function(){
														bootbox.alert({
															size: "small",
															title: "激活提示",
															message: "激活失败",
														})
													}	
												)
											}
										}
									})
								}
							})
						}
					}
				}

				//授权数量
				approve.onclick = function(){
					var value = $("#approveValue").val();
					dsmetoken.approve('0x8ee6088fd06e20022e4e38c6587b391596c1959b',value*10**18).sendTransaction({from:accounts[0]}).then(function(r){
						bootbox.alert({
							size: "small",
							title: "交易提示",
							message:"授权成功",
						})
					})
				}

				//初级空投领取
				button_chuji.onclick = function(){
					system.playerMap(accounts[0]).call().then(function(resul) {
						if (resul > 0) {
							kongtou.playmap(accounts[0]).call().then(function(resu) {
								if (new Date().getTime() / 1000 - resu[0] >= 86400){											
									kongtou.sign().sendTransaction({from:accounts[0]}).then(function(){
										kongtou.playmapping(accounts[0]).call().then(function(response){
											if(response[0].length == 0){
												bootbox.alert({
												size: "small",
												title: "空投提示",
												message:"恭喜您领取成功",
												callback:function(){}
											})
											}else{
											bootbox.alert({
												size: "small",
												title: "空投提示",
												message:"恭喜您领取成功，本次空投公共基础系数Abs：" + response[0]/10 + ",空投随机系数N：" + response[3]/10 +
												",等级加成Ls：" + response[4] + "%,共获得奖励 = Abs * N *(1+Ls) = " + response[2]/10**18 + " DSME" ,
												callback:function(){}
											})
											}
										})
									},function(){
										bootbox.alert({
											size: "small",
											title: "空投提示",
											message: "领取失败,请先获得领取白名",
										})
										}
									)																														
								} else {
									bootbox.alert({
										size: "small",
										title: "空投提示",
										message: "<p>上次领取时间：" + getLocalTime(resu[
												0]) +
											",</p><p> 还未到领取时间哦</p>",
									})
								}
							})
						} else {
							bootbox.alert({
										size: "small",
										title: "空投提示",
										message: "请完成激活后领取空投",
									})
						}
					})
				}	

				//质押lp
				pledge.onclick = function(){
					var value = $("#changeValue").val();
					if(new Date().getTime() / 1000 < 1636117200){
						bootbox.alert({
							size: "small",
							title: "质押提示",
							message: "质押开始时间为北京时间：2021.11.5 21:00:00",
						    callback: function(){location.reload();}
							})
					}else{
						dspoolcfl.pledge(value * 10**18).sendTransaction({from:accounts[0]}).then(function(r){
							bootbox.alert({
								size: "small",
								title: "交易提示",
								message: "质押成功",
							})
							},function(r){
							bootbox.alert({
								size: "small",
								title: "交易提示",
								message: "质押失败",
							})
						})
					}
				}

				//撤回
				withdraw.onclick = function (){
					var value = $("#changeValue").val();
					dspoolcfl.withdrawPledge(value * 10**18).sendTransaction({from:accounts[0]}).then(function(r){
						bootbox.alert({
							size: "small",
							title: "交易提示",
							message: "撤回成功",
						})
						},function(r){
						bootbox.alert({
							size: "small",
							title: "交易提示",
							message: "撤回失败",
						})
					})	
				}
				//lp收益
				dspoolcfl.calculation().call({from:accounts[0]}).then(function(re){
					$("#lpShouyi").html(toDecimal5(re/10**18));
				})
			})	
		</script>
		
	</div>
	<!-- 生态简介 -->
	<div class="container-fluid" style="margin-top:8px;">
		<div class="container fontcolor5"style="text-align:center;border-radius:12px;">
			<div class="row" style="text-align:center;margin-top:10px">
				<h4 style="color:#86a0a9">DSME应用场景</h4>
			</div>
			<div class="row" style="margin-top:10px">
			    <!--销毁回收-->
				<div class="col-xs-4">
					<img src="images/xiaohui.png" style="width:25px"><br/>
					<div class="row" style="height:7px">
					    <!--上下空白间隙-->
					</div>
					<strong><span>回收销毁</span> </strong>
					<p style="font-size:10px">用于回收并销毁DSME</p>
				</div>
				<!--奖励模块-->
				<div class="col-xs-4">
					<img src="images/jiangli.png" style="width:25px"><br/>
					<div class="row" style="height:5px">
					    <!--上下空白间隙-->
					</div>
					<strong><span>奖励</span> </strong>
					<p style="font-size:10px">质押DSME奖励</p>
				</div>
				<!--DAO模块-->
				<div class="col-xs-4">
					<img src="images/dao.png" style="width:25px"><br/>
					<div class="row" style="height:5px">
					    <!--上下空白间隙-->
					</div>
					<strong><span>DAO</span> </strong>
					<p style="font-size:10px">社区提案及提案</p>
				</div>
				<!--留白行-->
				<div class="row" style="height:50px">
				    <!--留白行-->
				</div>
			</div>
		</div>
		<!--留白行-->
				<div class="row" style="height:50px">
				    <!--留白行-->
				</div>
	</div>
	</body>
</html>
